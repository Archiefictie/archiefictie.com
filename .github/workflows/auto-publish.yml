name: Auto Publish Random Story

on:
  workflow_dispatch:       # handmatige trigger
  schedule:
    - cron: '0 10 * * 2'  # elke dinsdag om 11:00 CET

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ Config git voor commits
      - name: Setup Git
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

      # 3️⃣ Kies random verhaal uit pool
      - name: Pick random story
        id: pick
        run: |
          FILE=$(ls pool/*.html | shuf -n 1)
          echo "file=$FILE" >> $GITHUB_OUTPUT

      # 4️⃣ Kopieer naar live-stories
      - name: Copy to live-stories
        run: |
          cp "${{ steps.pick.outputs.file }}" live-stories/

      # 5️⃣ Verwijder bestand uit pool
      - name: Remove from pool
        run: |
          git rm "${{ steps.pick.outputs.file }}"

      # 6️⃣ Commit en push
      - name: Commit and Push
        run: |
          git add live-stories/
          git commit -m "Auto publish random story: $(basename ${{ steps.pick.outputs.file }})"
          git push origin main
